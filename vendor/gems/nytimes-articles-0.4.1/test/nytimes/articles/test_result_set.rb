require File.dirname(__FILE__) + '/../../test_helper.rb'

RESULT_SET_HASH = {"results"=>[{"lead_paragraph"=>"", "classifiers_facet"=>["Top/News/Business", "Top/Classifieds/Job Market/Job Categories/Banking, Finance and Insurance", "Top/News/Business/Markets"], "title"=>"Wall Street on Even Keel After Sell-Off", "nytd_title"=>"Wall Street on Even Keel After Sell-Off", "byline"=>"By JACK HEALY and MATTHEW SALTMARSH", "body"=>"A day after fleeing stocks in a fierce sell-off, investors on Wall Street stayed mostly at bay on Wednesday. Shares on Wall Street were hovering slightly higher at midday Wednesday as investors tried to get a better grip on Washington&#8217;s newly announced plans to stabilize the shaky banking system with up to $2.5 trillion in public and private", "material_type_facet"=>["News"], "url"=>"http://www.nytimes.com/2009/02/12/business/12markets.html", "publication_month"=>"02", "date"=>"20090212", "publication_year"=>"2009", "source_facet"=>"The New York Times", "desk_facet"=>"Business", "publication_day"=>"12", "des_facet"=>["STOCKS AND BONDS"], "day_of_week_facet"=>"Thursday"}, {"page_facet"=>"8", "lead_paragraph"=>"", "classifiers_facet"=>["Top/News/Business", "Top/Classifieds/Job Market/Job Categories/Banking, Finance and Insurance", "Top/News/Business/Markets"], "title"=>"Wall St. Treads Water as It Waits on Washington", "nytd_title"=>"Wall St. Treads Water as It Waits on Washington", "byline"=>"By JACK HEALY", "body"=>"Wall Street held its breath on Monday as it awaited details on a banking bailout from Washington. Investors had expected to start the week with an announcement from the Treasury Department outlining its latest plans to stabilize the financial system. But the Obama administration delayed releasing the details until at least Tuesday to keep the focus", "material_type_facet"=>["News"], "url"=>"http://www.nytimes.com/2009/02/10/business/10markets.html", "publication_month"=>"02", "date"=>"20090210", "publication_year"=>"2009", "source_facet"=>"The New York Times", "desk_facet"=>"Business", "publication_day"=>"10", "des_facet"=>["STOCKS AND BONDS"], "day_of_week_facet"=>"Tuesday"}, {"lead_paragraph"=>"", "geo_facet"=>["WALL STREET (NYC)"], "classifiers_facet"=>["Top/Opinion/Opinion/Letters", "Top/Opinion", "Top/Opinion/Opinion", "Top/Features/Travel/Guides/Destinations/North America", "Top/Features/Travel/Guides/Destinations/North America/United States/New York", "Top/Features/Travel/Guides/Destinations/North America/United States"], "title"=>"LETTER; Wall Street Blues", "nytd_title"=>"Wall Street Blues", "body"=>"To the Editor: Re &#8220;Wall St., a Financial Epithet, Stirs Outrage and Punch Lines&#8221; (front page, Feb. 3): I have some news for the Wall Street worker who ponders working for a nonprofit from 8 to 4 instead of on Wall Street, where long hours are the norm. I was a college administrator and English teacher for 15 years. Every night and all", "material_type_facet"=>["Letter"], "url"=>"http://www.nytimes.com/2009/02/09/opinion/lweb09econ.html", "publication_month"=>"02", "date"=>"20090209", "column_facet"=>"Letter", "publication_year"=>"2009", "source_facet"=>"The New York Times", "desk_facet"=>"Opinion", "publication_day"=>"09", "des_facet"=>["NONPROFIT ORGANIZATIONS", "EXECUTIVE COMPENSATION"], "day_of_week_facet"=>"Monday"}, {"page_facet"=>"29", "lead_paragraph"=>"", "geo_facet"=>["WALL STREET (NYC)"], "small_image_width"=>"75", "classifiers_facet"=>["Top/News/New York and Region", "Top/Classifieds/Job Market/Job Categories/Education", "Top/Features/Travel/Guides/Destinations/North America", "Top/Classifieds/Job Market/Job Categories/Banking, Finance and Insurance", "Top/Features/Travel/Guides/Destinations/North America/United States/New York", "Top/Features/Travel/Guides/Destinations/North America/United States", "Top/News/Education"], "title"=>"OUR TOWNS; As Pipeline to Wall Street Narrows, Princeton Students Adjust Sights", "nytd_title"=>"As Pipeline to Wall Street Narrows, Princeton Students Adjust Sights", "byline"=>"By PETER APPLEBOME", "body"=>"Princeton, N.J. There must be a screenplay in the fabulous Schoppe twins, Christine and Jennifer, Princeton University juniors from Houston. They had the same G.P.A. and SATs in high school, where they became Gold Award Girl Scouts , sort of the female version of Eagle Scouts. They live together and take all the same courses, wear identical", "material_type_facet"=>["News"], "url"=>"http://www.nytimes.com/2009/02/08/nyregion/08towns.html", "publication_month"=>"02", "small_image_height"=>"75", "date"=>"20090208", "column_facet"=>"Our Towns", "small_image"=>"Y", "publication_year"=>"2009", "source_facet"=>"The New York Times", "org_facet"=>["PRINCETON UNIVERSITY"], "desk_facet"=>"New York Region", "publication_day"=>"08", "small_image_url"=>"http://graphics8.nytimes.com/images/2009/02/08/nyregion/08towns.751.jpg", "des_facet"=>["EDUCATION AND SCHOOLS", "BANKS AND BANKING"], "day_of_week_facet"=>"Sunday"}, {"page_facet"=>"1", "lead_paragraph"=>"", "geo_facet"=>["WALL STREET (NYC)"], "classifiers_facet"=>["Top/News/Business", "Top/News/Business/Markets", "Top/Features/Travel/Guides/Destinations/North America", "Top/Classifieds/Job Market/Job Categories/Banking, Finance and Insurance", "Top/Features/Travel/Guides/Destinations/North America/United States/New York", "Top/Features/Travel/Guides/Destinations/North America/United States"], "title"=>"Wall St. Pay Is Cyclical. Guess Where We Are Now.", "nytd_title"=>"Wall St. Pay Is Cyclical. Guess Where We Are Now.", "byline"=>"By STEVE LOHR", "body"=>"To most people, a salary cap of $500,000 would be anything but punishment. But in Wall Street&#8217;s executive suites, it amounts to a humbling pay cut &#151; and, just maybe, the beginning of a cultural shift. True, the rich always seem to find new ways to get richer. But in the sweep of history, high pay on Wall Street comes and goes through", "material_type_facet"=>["News"], "url"=>"http://www.nytimes.com/2009/02/05/business/05bonus.html", "publication_month"=>"02", "date"=>"20090205", "publication_year"=>"2009", "source_facet"=>"The New York Times", "desk_facet"=>"Business", "publication_day"=>"05", "des_facet"=>["BONUSES", "BANKS AND BANKING", "SUBPRIME MORTGAGE CRISIS", "EXECUTIVE COMPENSATION"], "day_of_week_facet"=>"Thursday"}, {"page_facet"=>"26", "lead_paragraph"=>"", "geo_facet"=>["WALL STREET (NYC)"], "small_image_width"=>"75", "classifiers_facet"=>["Top/Opinion/Opinion/Letters", "Top/Opinion", "Top/Opinion/Opinion", "Top/Features/Travel/Guides/Destinations/North America", "Top/Features/Travel/Guides/Destinations/North America/United States/New York", "Top/Features/Travel/Guides/Destinations/North America/United States"], "title"=>"LETTERS; Wall St. and the $500,000 Question", "nytd_title"=>"Wall St. and the $500,000 Question", "body"=>"To the Editor: Re &#8220;Amid Fury, U.S. Is Set to Curb Executives&#8217; Pay After Bailouts&#8221; (front page, Feb. 4): It may be that the $500,000 cap is a bit extreme, but America should celebrate that there is at last some mechanism to rein in top corporate compensation. Public outrage and shareholder revolts have not managed to do so, since", "material_type_facet"=>["Letter"], "url"=>"http://www.nytimes.com/2009/02/05/opinion/l05econ.html", "publication_month"=>"02", "small_image_height"=>"75", "date"=>"20090205", "column_facet"=>"Letters", "small_image"=>"Y", "publication_year"=>"2009", "source_facet"=>"The New York Times", "desk_facet"=>"Opinion", "publication_day"=>"05", "small_image_url"=>"http://graphics8.nytimes.com/images/2009/02/05/opinion/05letter.75.gif", "des_facet"=>["EMERGENCY ECONOMIC STABILIZATION ACT (2008)", "EXECUTIVES AND MANAGEMENT", "WAGES AND SALARIES", "SUBPRIME MORTGAGE CRISIS"], "day_of_week_facet"=>"Thursday"}, {"page_facet"=>"1", "lead_paragraph"=>"", "geo_facet"=>["UNITED STATES"], "classifiers_facet"=>["Top/News/World/Countries and Territories/United States", "Top/News/Business/Personal Finance", "Top/News/Front Page", "Top/Features/Travel/Guides/Destinations/North America", "Top/News/Business", "Top/News/Business/Markets", "Top/Classifieds/Job Market/Job Categories/Executive", "Top/News", "Top/Classifieds/Job Market/Job Categories/Banking, Finance and Insurance", "Top/Features/Travel/Guides/Destinations/North America/United States"], "title"=>"Wall St., a Financial Epithet, Stirs Outrage and Punch Lines", "nytd_title"=>"Wall St., a Financial Epithet, Stirs Outrage", "byline"=>"By DAVID SEGAL", "body"=>"Monday was the last day of Iris Chau's 11-year career at JPMorgan Chase and she says there's a lot she'll miss about the job, including her colleagues, her paycheck and her role managing a technical support team. But one thing she won't miss about JPMorgan: telling people that she works there. ''For a long time, it was kind of glamorous and I had", "material_type_facet"=>["News"], "word_count"=>"1472", "url"=>"http://www.nytimes.com/2009/02/03/business/03bankers.html", "publication_month"=>"02", "abstract"=>"Financial industry has become national pariah, as country fumes over billions spent on bailouts and bonuses; many workers feel they are unfairly singled out for blame for crisis that was created by numerous players; there has been huge loss of status and cultural cachet as industry has become target of rage, raw material for talk-show tirades and comedians; fall in stature has taken toll on those industry veterans who are even willing to discuss it and, when they do, they attribute much of financial crisis to others; photos (M)", "small_image_height"=>"75", "date"=>"20090203", "fee"=>"N", "small_image"=>"Y", "publication_year"=>"2009", "source_facet"=>"The New York Times", "nytd_lead_paragraph"=>"As investment bankers adjust to a new role as targets of scorn, they aren\342\200\231t expecting pity, or a sympathetic ear.", "desk_facet"=>"Business/Financial Desk", "publication_day"=>"03", "small_image_url"=>"http://graphics8.nytimes.com/images/2009/02/02/business/03bankers_75.jpg", "nytd_des_facet"=>["Executives and Management", "Investment Banking", "Personal Finances", "Layoffs and Job Reductions", "High Net Worth Individuals", "Bonuses", "Executive Compensation", "Banks and Banking"], "des_facet"=>["EXECUTIVES AND MANAGEMENT", "INVESTMENT BANKING", "PERSONAL FINANCES", "BANKS AND BANKING", "LAYOFFS AND JOB REDUCTIONS", "LABOR", "BONUSES", "STOCKS AND BONDS", "BUDGETS AND BUDGETING", "EXECUTIVE COMPENSATION", "HIGH NET WORTH INDIVIDUALS", "FINANCES"], "day_of_week_facet"=>"Tuesday"}, {"page_facet"=>"20", "lead_paragraph"=>"", "classifiers_facet"=>["Top/Opinion/Opinion/Letters", "Top/Opinion", "Top/Opinion/Opinion"], "title"=>"LETTERS; Wall St. Bonuses: Enough Is Enough", "body"=>"To the Editor: Re ''Money for Nothing,'' by Dave Krasne (Op-Ed, Jan. 27): In the discussion of regulating executive compensation, the question has been asked, ''Without the most significant of financial rewards, how will we attract the very best to occupy these lofty positions?'' The implicit assumption of this statement is that society's very best", "material_type_facet"=>["Letter"], "word_count"=>"760", "url"=>"http://query.nytimes.com/gst/fullpage.html?res=9401E3D91431F931A35751C0A96F9C8B63", "publication_month"=>"02", "date"=>"20090202", "column_facet"=>"LETTERS", "publication_year"=>"2009", "source_facet"=>"The New York Times", "desk_facet"=>"Editorial Desk", "publication_day"=>"02", "day_of_week_facet"=>"Monday"}, {"page_facet"=>"11", "lead_paragraph"=>"", "classifiers_facet"=>["Top/Opinion/Opinion/Editorials", "Top/Opinion", "Top/News/Washington/Campaign 2008/Candidates", "Top/News/Washington/Campaign 2008", "Top/Opinion/Opinion"], "title"=>"OP-ED COLUMNIST; Disgorge, Wall Street Fat Cats", "nytd_title"=>"Disgorge, Wall Street Fat Cats", "byline"=>"By MAUREEN DOWD", "body"=>"The president's disgust at Wall Street looters was good. But we need more. We need disgorgement. Disgorgement is when courts force wrongdoers to repay ill-gotten gains. And I'm ill at the gains gotten by scummy executives acting all Gordon Gekko while they're getting bailed out by us. With the equally laconic Tim Geithner beside him, Mr. Obama", "material_type_facet"=>["Editorial"], "word_count"=>"807", "url"=>"http://www.nytimes.com/2009/02/01/opinion/01dowd.html", "publication_month"=>"02", "date"=>"20090201", "column_facet"=>"OP-ED COLUMNIST", "fee"=>"N", "publication_year"=>"2009", "source_facet"=>"The New York Times", "nytd_lead_paragraph"=>"The president\342\200\231s disgust at Wall Street looters was good. But we need more. We need disgorgement. Disgorgement is when courts force wrongdoers to repay ill-gotten gains.", "desk_facet"=>"Editorial Desk", "publication_day"=>"01", "per_facet"=>["OBAMA, BARACK"], "nytd_des_facet"=>["United States Economy", "Executive Compensation", "Subprime Mortgage Crisis"], "des_facet"=>["UNITED STATES ECONOMY", "EXECUTIVE COMPENSATION", "SUBPRIME MORTGAGE CRISIS"], "day_of_week_facet"=>"Sunday"}, {"page_facet"=>"1", "lead_paragraph"=>"", "geo_facet"=>["WALL STREET (NYC)"], "classifiers_facet"=>["Top/News/Front Page", "Top/Features/Travel/Guides/Destinations/North America", "Top/News/Business", "Top/News/Business/Markets", "Top/News/Washington/Campaign 2008", "Top/News", "Top/Classifieds/Job Market/Job Categories/Banking, Finance and Insurance", "Top/News/Washington/Campaign 2008/Candidates", "Top/Features/Travel/Guides/Destinations/North America/United States/New York", "Top/Features/Travel/Guides/Destinations/North America/United States"], "title"=>"What Red Ink? Wall St. Paid Hefty Bonuses", "nytd_title"=>"What Red Ink? Wall Street Paid Hefty Bonuses", "byline"=>"By BEN WHITE; Paul J. Sullivan contributed reporting.", "body"=>"By almost any measure, 2008 was a complete disaster for Wall Street -- except, that is, when the bonuses arrived. Despite crippling losses, multibillion-dollar bailouts and the passing of some of the most prominent names in the business, employees at financial companies in New York, the now-diminished world capital of capital, collected an", "material_type_facet"=>["News"], "word_count"=>"992", "url"=>"http://www.nytimes.com/2009/01/29/business/29bonus.html", "publication_month"=>"01", "abstract"=>"Wall Street paid out estimated $18.4 billion in bonuses last year, despite crippling losses, multi-billion-dollar bailouts and veritable banishment of well-known heads of financial firms; New York State Comptroller Thomas DiNapoli reports that it is sixth largest amount on record, matching 2004 when Dow Jones industrial average was above 10,000; estimate is based on personal income-tax collections and excludes stock option awards that could push figure even higher; DiNapoli says it is unclear whether bailouts helped make bonuses possible and urges Obama administration to examine issue; graphs (M)", "date"=>"20090129", "fee"=>"N", "publication_year"=>"2009", "source_facet"=>"The New York Times", "nytd_lead_paragraph"=>"Despite crippling losses in 2008, financial employees in New York collected an estimated $18.4 billion in bonuses for the year.", "desk_facet"=>"Business/Financial Desk", "publication_day"=>"29", "nytd_geo_facet"=>["Wall Street (NYC)"], "per_facet"=>["OBAMA, BARACK", "DINAPOLI, THOMAS P"], "nytd_des_facet"=>["Executive Compensation", "High Net Worth Individuals", "Bonuses", "Subprime Mortgage Crisis", "Brokers and Brokerage Firms"], "des_facet"=>["STOCK OPTIONS AND PURCHASE PLANS", "SUBPRIME MORTGAGE CRISIS", "HIGH NET WORTH INDIVIDUALS", "BONUSES", "STOCKS AND BONDS", "WAGES AND SALARIES", "EXECUTIVE COMPENSATION", "ETHICS", "BROKERS AND BROKERAGE FIRMS"], "day_of_week_facet"=>"Thursday"}], "total"=>3292, "tokens"=>["title:wall", "street"], "offset"=>"0"}

class TestNytimes::TestArticles::TestResultSet < Test::Unit::TestCase
	include Nytimes::Articles
	
	context "ResultSet.init_from_api" do
		setup do
			@result_set = ResultSet.init_from_api(RESULT_SET_HASH)
		end
		
		should "read the offset from the results hash @offset field" do
			assert_equal RESULT_SET_HASH["offset"].to_i, @result_set.offset
		end
		
		should "read the total_results from the results_hash total field" do
			assert_equal RESULT_SET_HASH["total"].to_i, @result_set.total_results
		end
		
		should "return results as an array of Article objects" do
			assert_kind_of(Array, @result_set.results)
			assert @result_set.results.all? {|r| r.is_a? Article }
		end
	end
	
	context "page_number" do
		setup do
			@result_set = ResultSet.init_from_api(RESULT_SET_HASH)
		end
		
		should "be offset + 1" do
			assert_equal 1, @result_set.page_number
		end
		
		should "be 0 if total_results is 0" do
			result_set = ResultSet.new(:total_results => 0)
			assert_equal 0, result_set.page_number
		end
	end
	
	context "total_pages" do
		should "be 1 if less than BATCH_SIZE results" do
			result_set = ResultSet.new(:total_results => 7)
			assert_equal 1, result_set.total_pages
		end
		
		should "be 0 if 0 results returned" do
			result_set = ResultSet.new(:total_results => 0)
			assert_equal 0, result_set.total_pages
		end
		
		should "be ceil(total_results / batch_size)" do
			result_set = ResultSet.new(:total_results => 23)
			assert_equal 3, result_set.total_pages
			
			result_set = ResultSet.new(:total_results => 20)
			assert_equal 2, result_set.total_pages
		end
	end
end
	